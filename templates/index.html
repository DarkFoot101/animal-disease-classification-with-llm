<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Animal Disease Classifier</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#070A1A;
      --bg2:#0B1226;
      --card: rgba(255,255,255,0.08);
      --card2: rgba(255,255,255,0.12);
      --border: rgba(255,255,255,0.14);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.70);
      --muted2: rgba(255,255,255,0.55);
      --good:#27e0a3;
      --warn:#ffcc66;
      --bad:#ff5d73;
      --accent:#7c3aed;
      --accent2:#22c55e;
      --shadow: 0 30px 70px rgba(0,0,0,.45);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(124,58,237,.40), transparent 55%),
        radial-gradient(1200px 700px at 90% 20%, rgba(34,197,94,.25), transparent 55%),
        radial-gradient(1200px 700px at 30% 90%, rgba(59,130,246,.20), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
      overflow-x:hidden;
    }

    .shell{
      width:min(1120px, 100%);
      display:grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap:18px;
    }

    @media (max-width: 980px){
      .shell{grid-template-columns:1fr}
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      overflow:hidden;
      position:relative;
    }

    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background: linear-gradient(135deg,
        rgba(124,58,237,.35),
        rgba(34,197,94,.20),
        rgba(59,130,246,.18)
      );
      filter: blur(18px);
      opacity:.35;
      z-index:-1;
    }

    .left{
      padding:22px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding-bottom:14px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      margin-bottom:16px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .logo{
      width:42px;
      height:42px;
      border-radius:14px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.35), transparent 70%),
        linear-gradient(135deg, rgba(124,58,237,.95), rgba(34,197,94,.75));
      display:grid;
      place-items:center;
      box-shadow: 0 14px 30px rgba(124,58,237,.25);
    }

    .logo svg{opacity:.95}

    .title{
      display:flex;
      flex-direction:column;
      line-height:1.15;
    }

    .title h1{
      margin:0;
      font-size:16px;
      font-weight:800;
      letter-spacing:.2px;
    }

    .title p{
      margin:0;
      color:var(--muted2);
      font-size:12px;
      font-weight:500;
    }

    .badge{
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color:var(--muted);
      font-size:12px;
      font-weight:600;
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }

    .badge .dot{
      width:10px;
      height:10px;
      border-radius:999px;
      background: var(--good);
      box-shadow: 0 0 18px rgba(39,224,163,.45);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }

    @media (max-width: 680px){
      .grid{grid-template-columns:1fr}
    }

    .dropzone{
      height:360px;
      border-radius: 18px;
      border:1px dashed rgba(255,255,255,0.22);
      background: rgba(255,255,255,0.05);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
      position:relative;
      transition: .22s ease;
      overflow:hidden;
    }
    .dropzone.dragover{
      transform: translateY(-2px);
      border-color: rgba(124,58,237,.55);
      box-shadow: 0 18px 45px rgba(124,58,237,.22);
      background: rgba(124,58,237,0.10);
    }

    .preview{
      width:100%;
      height:100%;
      border-radius: 14px;
      object-fit: cover;
      display:none;
    }

    .dz-inner{
      text-align:center;
      max-width: 330px;
    }

    .dz-inner h2{
      margin:0 0 8px 0;
      font-size:16px;
      font-weight:800;
    }

    .dz-inner p{
      margin:0 0 14px 0;
      color:var(--muted2);
      font-size:13px;
      line-height:1.35;
    }

    .btns{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
    }

    .btn{
      appearance:none;
      border:none;
      outline:none;
      cursor:pointer;
      border-radius: 14px;
      padding:12px 14px;
      font-weight:800;
      font-size:13px;
      color:rgba(255,255,255,.95);
      background: rgba(255,255,255,0.08);
      border:1px solid rgba(255,255,255,0.12);
      transition: .18s ease;
      display:flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }

    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,0.11);}
    .btn:active{transform: translateY(0px); opacity:.95;}

    .btn.primary{
      background: linear-gradient(135deg, rgba(124,58,237,.95), rgba(34,197,94,.70));
      border: none;
      box-shadow: 0 18px 45px rgba(124,58,237,.25);
    }

    .btn.primary:hover{
      filter: brightness(1.02);
      transform: translateY(-1px);
    }

    .hint{
      margin-top:14px;
      font-size:12px;
      color:var(--muted2);
    }

    .right{
      padding:20px;
    }

    .panel-title{
      margin:0 0 10px 0;
      font-size:14px;
      font-weight:900;
      color: rgba(255,255,255,.92);
    }

    .resultCard{
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      border-radius: 18px;
      padding:14px;
      min-height: 360px;
      display:flex;
      flex-direction:column;
      gap:12px;
      position:relative;
      overflow:hidden;
    }

    .resultCard::after{
      content:"";
      position:absolute;
      width:420px;
      height:420px;
      right:-220px;
      top:-240px;
      background: radial-gradient(circle, rgba(124,58,237,.24), transparent 60%);
      filter: blur(12px);
      opacity:.9;
      pointer-events:none;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:9px 12px;
      border-radius:999px;
      background: rgba(255,255,255,0.07);
      border:1px solid rgba(255,255,255,0.12);
      color:var(--muted);
      font-weight:700;
      font-size:12px;
      width:fit-content;
    }

    .pill .dot{
      width:10px;height:10px;border-radius:999px;
      background: var(--warn);
      box-shadow: 0 0 18px rgba(255,204,102,.25);
    }

    .bigPred{
      font-size: 24px;
      font-weight: 900;
      margin:2px 0 2px 0;
      letter-spacing: .2px;
    }

    .sub{
      color: var(--muted2);
      font-size: 13px;
      line-height: 1.35;
    }

    .barWrap{
      margin-top:8px;
      padding:12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
    }

    .barTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      color:var(--muted);
      font-weight:700;
      margin-bottom:8px;
    }

    .bar{
      height:10px;
      width:100%;
      border-radius:999px;
      background: rgba(255,255,255,0.10);
      overflow:hidden;
      position:relative;
    }

    .bar > span{
      display:block;
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(124,58,237,.95), rgba(34,197,94,.85));
      transition: width .55s ease;
    }

    .jsonBox{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      color: rgba(255,255,255,.85);
      background: rgba(0,0,0,0.25);
      border:1px solid rgba(255,255,255,0.10);
      border-radius: 16px;
      padding:12px;
      overflow:auto;
      max-height: 170px;
      z-index:1;
    }

    .footerNote{
      margin-top:auto;
      color: rgba(255,255,255,0.42);
      font-size: 12px;
      font-weight: 600;
      z-index:1;
    }

    /* Loading overlay */
    .overlay{
      position: fixed;
      inset: 0;
      display:none;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: 9999;
      align-items:center;
      justify-content:center;
      padding:20px;
    }

    .overlay.show{display:flex;}

    .loader{
      width: 72px;
      height: 72px;
      border-radius: 999px;
      border: 7px solid rgba(255,255,255,0.12);
      border-top-color: rgba(124,58,237,0.95);
      animation: spin 1s linear infinite;
      box-shadow: 0 18px 50px rgba(124,58,237,.18);
    }

    @keyframes spin{
      to{transform: rotate(360deg);}
    }

    input[type="file"]{display:none;}
    a{color:inherit}
  </style>
</head>

<body>
  <div class="shell">
    <!-- LEFT -->
    <div class="card left">
      <div class="topbar">
        <div class="brand">
          <div class="logo" aria-hidden="true">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
              <path d="M12 2C7.6 2 4 5.6 4 10c0 5.2 6.6 11.6 7.4 12.4.3.3.9.3 1.2 0C13.4 21.6 20 15.2 20 10c0-4.4-3.6-8-8-8Z"
                    stroke="white" stroke-width="1.8"/>
              <path d="M10.3 11.6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2Zm5.3 0c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2Z"
                    fill="white" opacity=".9"/>
              <path d="M7.8 14.2c.9 2 2.4 3.2 4.2 3.2s3.3-1.2 4.2-3.2"
                    stroke="white" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="title">
            <h1>Animal Disease Classifier</h1>
            <p>CNN prediction + clean UI + deploy-ready</p>
          </div>
        </div>

        <div class="badge">
          <span class="dot"></span>
          API: <span id="apiStatus">Ready</span>
        </div>
      </div>

      <div class="grid">
        <div class="dropzone card" id="dropzone">
          <img id="preview" class="preview" alt="preview"/>
          <div class="dz-inner" id="dzInner">
            <h2>Upload an image</h2>
            <p>Drag & drop your image here, or upload from your device.<br/>Supports JPG/PNG.</p>

            <div class="btns">
              <button class="btn" id="btnUpload" type="button">
                üì§ Upload
              </button>
              <button class="btn primary" id="btnPredict" type="button" disabled>
                ‚ö° Predict
              </button>
              <button class="btn" id="btnReset" type="button" disabled>
                ‚ôª Reset
              </button>
            </div>

            <div class="hint">
              Tip: Use a clear image for best accuracy.
            </div>
          </div>

          <input type="file" id="fileInput" accept="image/*"/>
        </div>

        <div class="card right">
          <h3 class="panel-title">Results</h3>

          <div class="resultCard">
            <div class="pill">
              <span class="dot" id="stateDot"></span>
              <span id="stateText">Waiting for image‚Ä¶</span>
            </div>

            <div>
              <div class="bigPred" id="predLabel">‚Äî</div>
              <div class="sub" id="predSub">
                Upload an image and hit Predict. Your model output will appear here.
              </div>
            </div>

            <div class="barWrap">
              <div class="barTop">
                <span>Confidence</span>
                <span id="confText">0%</span>
              </div>
              <div class="bar">
                <span id="confBar"></span>
              </div>
            </div>

            <div class="jsonBox" id="jsonBox">{}</div>

            <div class="footerNote">
              Built for production deployment ‚Ä¢ FastAPI/Flask compatible endpoint: <b>/predict</b>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- LOADING OVERLAY -->
  <div class="overlay" id="overlay">
    <div class="loader"></div>
  </div>

  <script>
    // Change this if your backend endpoint is different
    // If you deploy, use full URL: "https://your-domain.com/predict"
    const PREDICT_URL = "/predict";

    const fileInput  = document.getElementById("fileInput");
    const dropzone   = document.getElementById("dropzone");
    const preview    = document.getElementById("preview");
    const dzInner    = document.getElementById("dzInner");

    const btnUpload  = document.getElementById("btnUpload");
    const btnPredict = document.getElementById("btnPredict");
    const btnReset   = document.getElementById("btnReset");

    const overlay    = document.getElementById("overlay");
    const apiStatus  = document.getElementById("apiStatus");

    const stateDot   = document.getElementById("stateDot");
    const stateText  = document.getElementById("stateText");
    const predLabel  = document.getElementById("predLabel");
    const predSub    = document.getElementById("predSub");

    const confBar    = document.getElementById("confBar");
    const confText   = document.getElementById("confText");
    const jsonBox    = document.getElementById("jsonBox");

    let selectedFile = null;

    function setState(type, text){
      stateText.textContent = text;

      if(type === "ready"){
        stateDot.style.background = "var(--warn)";
      } else if(type === "ok"){
        stateDot.style.background = "var(--good)";
      } else if(type === "error"){
        stateDot.style.background = "var(--bad)";
      } else {
        stateDot.style.background = "var(--warn)";
      }
    }

    function setLoading(isLoading){
      overlay.classList.toggle("show", isLoading);
      apiStatus.textContent = isLoading ? "Predicting..." : "Ready";
    }

    function resetUI(){
      selectedFile = null;
      preview.style.display = "none";
      dzInner.style.display = "block";
      fileInput.value = "";

      btnPredict.disabled = true;
      btnReset.disabled = true;

      predLabel.textContent = "‚Äî";
      predSub.textContent = "Upload an image and hit Predict. Your model output will appear here.";
      confBar.style.width = "0%";
      confText.textContent = "0%";
      jsonBox.textContent = "{}";
      setState("idle", "Waiting for image‚Ä¶");
    }

    function showPreview(file){
      const url = URL.createObjectURL(file);
      preview.src = url;
      preview.style.display = "block";
      dzInner.style.display = "none";

      btnPredict.disabled = false;
      btnReset.disabled = false;

      setState("ready", "Image ready ");
      predSub.textContent = "Click Predict to run inference.";
    }

    btnUpload.addEventListener("click", () => fileInput.click());

    btnReset.addEventListener("click", () => resetUI());

    fileInput.addEventListener("change", (e) => {
      if(!e.target.files || !e.target.files[0]) return;
      selectedFile = e.target.files[0];
      showPreview(selectedFile);
    });

    // Drag & Drop
    ["dragenter","dragover"].forEach(ev => {
      dropzone.addEventListener(ev, (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.add("dragover");
      });
    });

    ["dragleave","drop"].forEach(ev => {
      dropzone.addEventListener(ev, (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.remove("dragover");
      });
    });

    dropzone.addEventListener("drop", (e) => {
      const files = e.dataTransfer.files;
      if(files && files[0]){
        selectedFile = files[0];
        showPreview(selectedFile);
      }
    });

    function normalizeResponse(data){
      //  Supports multiple backend formats
      // Preferred format:
      // { prediction: "ClassName", confidence: 0.92, all_probs: {...} }
      // Old format:
      // [ {class: "...", confidence: ...}, {...} ]

      let prediction = null;
      let confidence = null;

      if(Array.isArray(data)){
        // your old UI format sometimes returns res[0]
        if(data[0] && typeof data[0] === "object"){
          prediction = data[0].prediction || data[0].class || data[0].label || null;
          confidence = data[0].confidence ?? data[0].score ?? null;
        }
      } else if(typeof data === "object" && data !== null){
        prediction = data.prediction || data.class || data.label || null;
        confidence = data.confidence ?? data.score ?? null;
      }

      if(confidence !== null){
        // allow confidence given as percentage or 0-1
        if(confidence > 1) confidence = confidence / 100;
        confidence = Math.max(0, Math.min(1, confidence));
      }

      return { prediction, confidence, raw: data };
    }

    btnPredict.addEventListener("click", async () => {
      if(!selectedFile){
        setState("error", "Please upload an image first.");
        return;
      }

      setLoading(true);
      setState("ready", "Running inference‚Ä¶ ‚ö°");

      try{
        // Upload as multipart/form-data (most common for Flask/FastAPI)
        const formData = new FormData();
        formData.append("file", selectedFile);

        const res = await fetch(PREDICT_URL, {
          method: "POST",
          body: formData
        });

        if(!res.ok){
          const txt = await res.text();
          throw new Error(`API Error ${res.status}: ${txt.slice(0,250)}`);
        }

        const data = await res.json();
        const parsed = normalizeResponse(data);

        // UI Update
        if(parsed.prediction){
          predLabel.textContent = parsed.prediction;
        } else {
          predLabel.textContent = "Prediction received ‚úÖ";
        }

        if(parsed.confidence !== null){
          const pct = Math.round(parsed.confidence * 100);
          confBar.style.width = pct + "%";
          confText.textContent = pct + "%";
          predSub.textContent = pct >= 80
            ? "High confidence prediction "
            : "Prediction done. Try a clearer image for better confidence.";
        } else {
          confBar.style.width = "0%";
          confText.textContent = "‚Äî";
          predSub.textContent = "Prediction done (confidence not provided by API)";
		}

        jsonBox.textContent = JSON.stringify(parsed.raw, null, 2);
        setState("ok", "Prediction complete ");

      } catch(err){
        setState("error", "Prediction failed ‚ùå");
        predLabel.textContent = "Error";
        predSub.textContent = err.message || "Something went wrong.";
        jsonBox.textContent = JSON.stringify({error: err.message}, null, 2);
      } finally{
        setLoading(false);
      }
    });

    // init
    resetUI();
  </script>
</body>
</html>
